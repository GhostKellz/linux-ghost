# Linux Ghost NVIDIA Configuration
# Based on ghostkellz production config
# Install to: /etc/modprobe.d/nvidia-ghost.conf

# ============================================
# DRM / Wayland
# ============================================

# Enable DRM modeset (required for Wayland and smooth rendering)
options nvidia-drm modeset=1

# Enable framebuffer device (required for 6.11+ kernels)
options nvidia-drm fbdev=1

# ============================================
# Performance Optimizations
# ============================================

# Enable PAT (better memory throughput)
options nvidia NVreg_UsePageAttributeTable=1

# Skip zeroing system memory allocations (slight perf gain, minimal risk on desktop)
options nvidia NVreg_InitializeSystemMemoryAllocations=0

# Low-latency GPU interrupt handling (reduces latency for gaming)
# RMIntrLockingMode=1 was enabled by default in r570+ but explicit is safer
options nvidia NVreg_RegistryDwords="RMIntrLockingMode=1"

# Enable Resizable BAR (requires BIOS support + compatible GPU)
options nvidia NVreg_EnableResizableBar=1

# ============================================
# Power Management / Suspend
# ============================================

# Preserve video memory after suspend (prevents corruption on resume)
options nvidia NVreg_PreserveVideoMemoryAllocations=1

# ============================================
# GSP Firmware (nvidia-open specific)
# ============================================

# NOTE: nvidia-open REQUIRES GSP firmware - cannot be disabled!
# For proprietary nvidia-dkms, you can disable GSP with:
# options nvidia NVreg_EnableGpuFirmware=0

# GSP task time slicing (reduces idle stutter on nvidia-open)
options nvidia NVreg_EnableGpuFirmwareTaskTimeSlice=1

# ============================================
# Compatibility
# ============================================

# Allow unsupported GPUs / VM passthrough
options nvidia NVreg_OpenRmEnableUnsupportedGpus=1

# ============================================
# Optional: Laptop / Mobile GPU
# ============================================

# Enable runtime power management (RTD3) for laptops
# Uncomment for laptop/mobile GPUs:
# options nvidia NVreg_DynamicPowerManagement=0x02
